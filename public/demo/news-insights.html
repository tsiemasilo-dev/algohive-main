<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive — News &amp; Insights</title>
    <script src="https://cdn.tailwindcss.com" nonce="ALGOHIVE"></script> 
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" /> 

  <style>
    :root { --page:#0b1220; --bg:#fff; --muted:#64748b; --ink:#0f172a; --olive:#7e8d52; --brand:#f59e0b; --line:#e5e7ef }
    html,body { font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink) }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; height:40px; padding:0 .875rem; border-radius:10px; border:1px solid var(--line); font-weight:600 }
    .topbar{ height:52px }

    #layout{ --sb:275px; display:grid; grid-template-columns:1fr; min-height:100vh }
    #ah-sidebar{ transition: transform .3s ease, width .2s ease; width:350px; max-width:85vw; position:fixed; top:0; z-index:50; height:100vh; transform:translateX(-100%); overflow-y:auto }
    #ah-sidebar.is-open { transform: translateX(0); }

    @media (min-width: 768px) {
      #layout{ grid-template-columns:var(--sb) 1fr }
      #layout.is-collapsed{ --sb:64px }
      #ah-sidebar{ position:sticky; top:0; width:var(--sb); max-width:none; height:100vh; transform:translateX(0); z-index:auto }
    }

    #ah-sidebar[data-collapsed="true"] .label,
    #ah-sidebar[data-collapsed="true"] .chevron { display:none }
    #ah-sidebar[data-collapsed="true"] #main-nav { visibility:hidden; pointer-events:none; }
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-menu{ display:none }
    #ah-sidebar details .sub{ transition:height .2s ease }
    #ah-sidebar[data-collapsed="true"] details>.sub{ display:none!important }
    #ah-sidebar[data-collapsed="true"] nav a,
    #ah-sidebar[data-collapsed="true"] details>summary{ justify-content:center; gap:.25rem }
    #ah-sidebar[data-collapsed="true"] details>summary span{ gap:0 }
    #ah-sidebar .footer{ transition:all .2s ease }
    #ah-sidebar[data-collapsed="true"] .footer{ justify-content:center; flex-direction:column; gap:12px }
    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg,i){ transform:rotate(180deg) }

    #ah-collapse { display:none; }
    @media (min-width: 768px) { #ah-collapse { display:inline-flex; } }

    #ah-brand-switcher { position: relative; }
    #ah-brand-switcher summary { list-style: none; }
    #ah-brand-switcher summary::-webkit-details-marker { display: none; }
    #ah-brand-switcher .brand-toggle { width: calc(100% - 12px); margin: 8px auto 4px; padding: 12px; border-radius: 16px; border: 1px solid #e2e8f0; background: #f8fafc; box-shadow: 0 16px 40px -28px rgba(15, 23, 42, 0.4); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: border-color .2s ease, box-shadow .2s ease; }
    #ah-brand-switcher .brand-toggle:hover { border-color: #cbd5e1; box-shadow: 0 16px 48px -28px rgba(15, 23, 42, 0.5); }
    #ah-brand-switcher .brand-marker { width: 40px; height: 40px; border-radius: 12px; border: 1px solid #e2e8f0; display: grid; place-items: center; background: white; }
    #ah-brand-switcher .brand-marker img { width: 28px; height: 28px; object-fit: contain; }
    #ah-brand-switcher .brand-marker .ph-logo-fallback { font-weight: 800; color: #0f172a; font-size: 13px; }
    #ah-brand-switcher .brand-menu { position: absolute; left: 0; right: 0; margin: 0 auto; width: calc(100% - 24px); background: white; border: 1px solid #e2e8f0; border-radius: 14px; box-shadow: 0 20px 48px -24px rgba(15, 23, 42, 0.38); padding: 10px; display: none; z-index: 10; }
    #ah-brand-switcher[open] .brand-menu { display: block; }
    #ah-brand-switcher .brand-menu-header { font-size: 12px; letter-spacing: .08em; text-transform: uppercase; color: #64748b; padding: 4px 6px; font-weight: 700; }
    #ah-brand-switcher .brand-option { display: flex; align-items: center; gap: 12px; padding: 10px 6px; border-radius: 12px; transition: background .2s ease; color: #0f172a; font-weight: 600; text-decoration: none; }
    #ah-brand-switcher .brand-option:hover { background: #f8fafc; }
    #ah-brand-switcher .brand-option img { width: 36px; height: 36px; object-fit: contain; border-radius: 10px; border: 1px solid #e2e8f0; }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle { width: 44px; padding: 10px; justify-content: center; }
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle .label,
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle .fa-chevron-down { display:none }
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-marker { margin: 0; }
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-marker img { width: 24px; height: 24px; }

    .top-bar {
        background: #ffffff;
        border-bottom: 1px solid #e8eaed;
        padding: 16px 0;
    }

    .top-bar-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        font-size: 22px;
        font-weight: 700;
        letter-spacing: -0.5px;
        color: #1a1d29;
    }

    .logo-accent {
        color: #7e8d52;
    }

    .user-info {
        font-size: 13px;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .header {
        background: #ffffff;
        padding: 48px 40px 32px 40px;
        border-bottom: 1px solid #e8eaed;
    }

    .header-content {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header h1 {
        font-size: 42px;
        font-weight: 700;
        color: #1a1d29;
        margin-bottom: 12px;
        letter-spacing: -1.5px;
    }

    .header-subtitle {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 36px;
    }

    .search-bar {
        position: relative;
        margin-bottom: 0;
        max-width: 600px;
    }

    .search-input {
        width: 100%;
        padding: 16px 24px 16px 52px;
        border: 2px solid #e8eaed;
        border-radius: 50px;
        font-size: 15px;
        background: #ffffff;
        transition: all 0.2s ease;
        outline: none;
    }

    .search-input:focus {
        border-color: #7e8d52;
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(126, 141, 82, 0.08);
    }

    .search-icon {
        position: absolute;
        left: 22px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 16px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 48px 40px;
    }

    .news-section {
        margin-bottom: 56px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .section-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a1d29;
        letter-spacing: -0.5px;
    }

    .tabs {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .tab {
        padding: 10px 24px;
        background: #ffffff;
        border: 2px solid #e8eaed;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s ease;
        border-radius: 50px;
    }

    .tab:hover {
        border-color: #7e8d52;
        color: #7e8d52;
    }

    .tab.active {
        background: linear-gradient(135deg, #7e8d52 0%, #99aa66 100%);
        color: #ffffff;
        border-color: #7e8d52;
    }

    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 24px;
    }

    .news-card.hidden {
        display: none;
    }

    .view-more-link {
        text-align: right;
        margin-top: 24px;
    }

    .view-more-link a {
        color: #7e8d52;
        font-weight: 600;
        font-size: 15px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
    }

    .view-more-link a:hover {
        color: #99aa66;
        gap: 12px;
    }

    .view-more-link.hidden {
        display: none;
    }

    .news-card.hidden {
        display: none;
    }

    .view-more-link {
        text-align: right;
        margin-top: 24px;
    }

    .view-more-link a {
        color: #7e8d52;
        font-weight: 600;
        font-size: 15px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
    }

    .view-more-link a:hover {
        color: #99aa66;
        gap: 12px;
    }

    .view-more-link.hidden {
        display: none;
    }

    .news-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 28px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid #e8eaed;
        position: relative;
        overflow: hidden;
    }

    .news-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #7e8d52 0%, #99aa66 100%);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
    }

    .news-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 32px rgba(126, 141, 82, 0.15);
        border-color: #7e8d52;
    }

    .news-card:hover::before {
        transform: scaleX(1);
    }

    .news-source {
        font-size: 11px;
        color: #7e8d52;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .news-title {
        font-size: 17px;
        font-weight: 600;
        color: #1a1d29;
        margin-bottom: 14px;
        line-height: 1.5;
        letter-spacing: -0.3px;
    }

    .news-ticker {
        display: inline-block;
        background: linear-gradient(135deg, #f3f0ff 0%, #e9d5ff 100%);
        color: #7e8d52;
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 11px;
        font-weight: 700;
        margin-right: 8px;
        margin-bottom: 10px;
        letter-spacing: 0.5px;
    }

    .news-meta {
        display: flex;
        align-items: center;
        gap: 16px;
        font-size: 13px;
        color: #9ca3af;
        margin-top: 18px;
        padding-top: 18px;
        border-top: 1px solid #f3f4f6;
    }

    .news-time {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .top-stories-section {
        background: #ffffff;
        border: 2px solid #e8eaed;
        border-radius: 20px;
        padding: 36px;
        margin-top: 56px;
    }

    .top-stories-header {
        font-size: 28px;
        font-weight: 700;
        color: #1a1d29;
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 12px;
        letter-spacing: -0.5px;
    }

    .top-stories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .top-story {
        padding: 20px;
        border: 2px solid #f3f4f6;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: #ffffff;
    }

    .top-story:hover {
        border-color: #7e8d52;
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(126, 141, 82, 0.1);
    }

    .top-story-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #7e8d52 0%, #99aa66 100%);
        color: #ffffff;
        border-radius: 50%;
        font-size: 14px;
        font-weight: 700;
        margin-right: 14px;
    }

    .top-story-content {
        display: inline-block;
        width: calc(100% - 50px);
        vertical-align: top;
    }

    .top-story-title {
        font-size: 15px;
        font-weight: 600;
        color: #1a1d29;
        line-height: 1.5;
        margin-bottom: 6px;
    }

    .top-story-meta {
        font-size: 12px;
        color: #9ca3af;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .loading {
        text-align: center;
        padding: 80px 20px;
        color: #9ca3af;
        font-size: 15px;
    }

    .spinner {
        border: 3px solid #f3f4f6;
        border-top: 3px solid #7e8d52;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        margin: 0 auto 24px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error {
        background: #fef2f2;
        border: 2px solid #fecaca;
        border-radius: 16px;
        padding: 32px;
        text-align: center;
        color: #dc2626;
    }

    .article-modal {
        position: fixed;
        inset: 0;
        background: rgba(6, 11, 25, 0.7);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 24px;
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        visibility: hidden;
        transition: opacity 0.25s ease;
    }

    .article-modal.is-visible {
        opacity: 1;
        pointer-events: auto;
        visibility: visible;
    }

    .article-modal-content {
        background: #ffffff;
        border-radius: 20px;
        width: min(100%, 1000px);
        height: min(90vh, 720px);
        border: 2px solid #e8eaed;
        box-shadow: 0 24px 80px rgba(18, 20, 32, 0.25);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .article-modal-toolbar {
        padding: 20px 24px;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
    }

    .article-modal-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        color: #1a1d29;
    }

    .article-modal-title i {
        color: #7e8d52;
    }

    .article-modal-actions {
        display: inline-flex;
        align-items: center;
        gap: 12px;
    }

    .article-modal-close {
        border: none;
        background: #f3f4f6;
        color: #1a1d29;
        padding: 10px 16px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: background 0.2s ease, color 0.2s ease;
    }

    .article-modal-close:hover {
        background: #e5e7eb;
    }

    .article-modal-frame {
        border: none;
        flex: 1;
        width: 100%;
        background: #f9fafb;
    }

    .article-modal-preview {
        padding: 28px;
        font-size: 15px;
        line-height: 1.8;
        color: #475569;
        overflow-y: auto;
    }

    .article-modal-preview p + p {
        margin-top: 1rem;
    }

    .article-modal-meta {
        font-size: 13px;
        color: #94a3b8;
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 16px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    .article-modal-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        font-weight: 600;
        color: #7e8d52;
        text-decoration: none;
    }

    .article-modal-link:hover {
        color: #99aa66;
    }

    .subscribe-modal {
        position: fixed;
        inset: 0;
        background: rgba(6, 11, 25, 0.7);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 24px;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        visibility: hidden;
        transition: opacity 0.25s ease;
    }

    .subscribe-modal.is-visible {
        opacity: 1;
        pointer-events: auto;
        visibility: visible;
    }

    .subscribe-modal-content {
        background: #ffffff;
        border-radius: 20px;
        width: min(100%, 480px);
        border: 2px solid #e8eaed;
        box-shadow: 0 24px 80px rgba(18, 20, 32, 0.25);
        overflow: hidden;
    }

    .subscribe-modal-header {
        padding: 28px;
        border-bottom: 1px solid #f3f4f6;
    }

    .subscribe-modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #1a1d29;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .subscribe-modal-subtitle {
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
    }

    .subscribe-modal-body {
        padding: 28px;
    }

    .subscribe-options {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .subscribe-option {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        border: 2px solid #e8eaed;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .subscribe-option:hover {
        border-color: #7e8d52;
        background: #f9fafb;
    }

    .subscribe-option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #7e8d52;
    }

    .subscribe-option-label {
        flex: 1;
        font-size: 15px;
        font-weight: 600;
        color: #1a1d29;
        cursor: pointer;
    }

    .subscribe-modal-footer {
        padding: 20px 28px;
        border-top: 1px solid #f3f4f6;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }

    .subscribe-btn {
        padding: 12px 24px;
        border-radius: 50px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }

    .subscribe-btn-primary {
        background: linear-gradient(135deg, #7e8d52 0%, #99aa66 100%);
        color: #ffffff;
        border-color: #7e8d52;
    }

    .subscribe-btn-primary:hover {
        box-shadow: 0 4px 12px rgba(126, 141, 82, 0.3);
        transform: translateY(-1px);
    }

    .subscribe-btn-secondary {
        background: #ffffff;
        color: #6b7280;
        border-color: #e8eaed;
    }

    .subscribe-btn-secondary:hover {
        background: #f9fafb;
        border-color: #cbd5e1;
    }

    @media (max-width: 768px) {
        .news-grid {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding-bottom: 12px;
            scroll-snap-type: x mandatory;
        }
        .news-grid::-webkit-scrollbar {
            display: none;
        }
        .top-stories-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .container {
            padding: 24px 16px;
        }
        
        .header {
            padding: 24px 16px 20px 16px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header-subtitle {
            font-size: 14px;
            margin-bottom: 20px;
        }

        .search-bar {
            max-width: 100%;
        }

        .search-input {
            padding: 12px 20px 12px 44px;
            font-size: 14px;
        }

        .search-icon {
            left: 16px;
            font-size: 14px;
        }

        .top-bar-content {
            padding: 0 16px;
        }

        .tabs {
            justify-content: flex-start;
            overflow-x: auto;
            flex-wrap: nowrap;
            gap: 8px;
            padding-bottom: 4px;
        }

        .tab {
            padding: 8px 16px;
            font-size: 13px;
        }

        .section-title {
            font-size: 22px;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .news-card {
            padding: 20px;
            min-width: 280px;
            flex-shrink: 0;
            scroll-snap-align: start;
        }

        .news-title {
            font-size: 15px;
            margin-bottom: 10px;
        }

        .news-source {
            font-size: 10px;
            margin-bottom: 10px;
        }

        .news-ticker {
            font-size: 10px;
            padding: 4px 10px;
        }

        .top-stories-section {
            padding: 24px 16px;
            margin-top: 32px;
        }

        .top-stories-header {
            font-size: 22px;
            margin-bottom: 20px;
        }

        .top-story {
            padding: 16px;
        }

        .top-story-number {
            width: 28px;
            height: 28px;
            font-size: 12px;
            margin-right: 12px;
        }

        .top-story-content {
            width: calc(100% - 44px);
        }

        .top-story-title {
            font-size: 14px;
        }

        .article-modal {
            padding: 20px 16px;
        }

        .article-modal-content {
            height: 90vh;
            border-radius: 16px;
        }

        .article-modal-toolbar {
            padding: 16px;
            flex-direction: row;
            align-items: center;
        }

        .article-modal-title {
            font-size: 14px;
            flex: 1;
            min-width: 0;
        }

        .article-modal-title span {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .article-modal-actions {
            flex-shrink: 0;
        }

        .article-modal-close {
            padding: 8px 12px;
            font-size: 12px;
        }

        .article-modal-preview {
            padding: 20px 16px;
            font-size: 14px;
        }

        .article-modal-meta {
            font-size: 11px;
            margin-bottom: 12px;
        }
    }

    @media (min-width: 768px) and (max-width: 1023px) {
      #layout { grid-template-columns: 1fr; }
      #layout.is-collapsed { --sb: 275px; }
      #ah-sidebar {
        position: fixed;
        top: 0;
        width: 350px;
        max-width: 85vw;
        height: 100vh;
        transform: translateX(-100%);
        z-index: 50;
      }
      #ah-sidebar.is-open { transform: translateX(0); }
      #ah-collapse { display: none; }
      #ah-mobile-menu-btn { display: inline-flex !important; }
      #ah-overlay { display: none; }
      #ah-overlay:not(.hidden) { display: block; }
    }
  </style>
  <script nonce="ALGOHIVE">
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>

<body class="min-h-screen overflow-x-hidden bg-white">
  <div id="layout">
    <div id="ah-overlay" class="fixed inset-0 bg-black/40 z-40 hidden md:hidden"></div>
    <aside id="ah-sidebar" data-collapsed="false" class="border-r border-slate-200 h-[100vh] bg-white flex flex-col">
      <details class="group border-b border-slate-200 pb-2" id="ah-brand-switcher">
        <summary class="brand-toggle">
          <div class="brand-marker">
            <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive Logo" class="w-7 h-7 object-contain" />
          </div>
          <div class="min-w-0">
            <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
            <div class="text-[11px] text-slate-500 label">Markets</div>
          </div>
          <i class="fa-solid fa-chevron-down text-slate-400 ml-auto transition-transform group-open:rotate-180"></i>
        </summary>
        <div class="brand-menu">
          <div class="brand-menu-header">Switch workspace</div>
          <a href="https://thealgohive.com/money/home" class="brand-option">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/ICON%20AHM.svg" alt="AlgoMoney Logo" />
            <div class="min-w-0 font-semibold text-slate-900 label algomoney-word">AlgoMoney</div>
          </a>
        </div>
      </details>

      <nav id="main-nav" class="p-2 text-[14px] flex-1 overflow-y-auto">
        <p class="px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Overview</p>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900" href="/demo/dashboard.html" title="Home">
          <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/home-01-stroke-rounded.svg" alt="" class="w-4 h-4 shrink-0" /><span class="label">Home</span>
        </a>

        <p class="mt-4 px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Markets</p>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/market-analysis-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Invest</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/demo/strategies.html" title="OpenStrategies">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/analysis-text-link-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">OpenStrategies</span>
            </a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funds">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/corporate-stroke-rounded.svg" alt="" class="w-4 h-4" />
              <span class="flex items-center gap-2">
                <span class="label">Funds</span>
                <span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span>
              </span>
            </a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/demo/markets.html" title="Markets">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/earth-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Markets</span>
            </a>
          </div>
        </details>

        <a class="mt-1 px-3 py-2 rounded-lg flex items-center gap-2 bg-slate-100 border border-slate-200 font-semibold text-slate-900" href="/demo/news-insights.html" title="News &amp; Insights">
          <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/news-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">News &amp; Insights</span>
        </a>

        <p class="mt-4 px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Account</p>
        <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="/demo/holdings.html" title="Holdings">
          <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/pie-chart-09-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Holdings</span>
        </a>
        <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="/demo/account-statements.html" title="Account Statements">
          <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/invoice-01-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Account Statements</span>
        </a>
        <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="#" title="Rewards">
          <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/gift-stroke-rounded.svg" alt="" class="w-4 h-4" />
          <span class="flex items-center gap-2"><span class="label">Rewards</span><span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span></span>
        </a>
        <details class="group mt-4">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center"><span class="label">Other</span></span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Help">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/help-circle-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Help</span>
            </a>
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Legal">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/audit-01-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Legal</span>
            </a>
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Learn">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/pencil-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="flex items-center gap-2"><span class="label">Learn</span><span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span></span>
            </a>
          </div>
        </details>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <a id="ah-settings" class="btn btn-settings h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" href="/demo/settings.html" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </a>
        <button id="ah-collapse" class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <main class="flex-1 min-w-0">
      <div class="px-4 md:px-6 pt-4 border-b border-slate-200 pb-4">
        <div class="flex items-center justify-between gap-4">
          <div class="flex items-start md:items-center gap-3 flex-1 min-w-0 max-w-[560px]">
            <button id="ah-mobile-menu-btn" class="md:hidden btn h-10 w-10 p-0 rounded-xl border-0" title="Open Menu">
              <i class="fa-solid fa-bars"></i>
            </button>
            <h1 class="text-xl font-bold text-slate-800 truncate">News & Insights</h1>
          </div>

                    <button id="profile-btn" class="shrink-0 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm hover:bg-slate-50">
                        <img id="profile-avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>" alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200" />
                        <span id="profile-name" class="text-sm font-semibold text-slate-900 hidden sm:inline">—</span>
                        <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
                    </button>
        </div>
      </div>

      <div class="header">
          <div class="header-content">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                  <h1 style="margin-bottom: 0;">Market Intelligence</h1>
                  <a href="#subscribe" id="subscribeLink" style="font-size: 12px; color: #7e8d52; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; white-space: nowrap;">
                      <i class="fas fa-bell" style="font-size: 10px;"></i>
                      Subscribe
                  </a>
              </div>
              <p class="header-subtitle">Real-time financial news and analysis from global markets</p>
              
              <div class="search-bar">
                  <i class="fas fa-search search-icon"></i>
                  <input type="text" class="search-input" placeholder="Search news, tickers, or topics..." id="searchInput">
              </div>
          </div>
      </div>

      <div class="container">
          <div class="news-section">
              <h2 class="section-title" style="margin-bottom: 24px;">Latest News</h2>
              
              <div class="tabs" style="margin-bottom: 32px;">
                  <button class="tab active" data-category="All News">All News</button>
                  <button class="tab" data-category="Markets">Markets</button>
                  <button class="tab" data-category="Stocks">Stocks</button>
                  <button class="tab" data-category="Forex">Forex</button>
                  <button class="tab" data-category="Crypto">Crypto</button>
                  <button class="tab" data-category="Commodities">Commodities</button>
                  <button class="tab" data-category="Economics">Economics</button>
                  <button class="tab" data-category="Technology">Technology</button>
                  <button class="tab" data-category="Energy">Energy</button>
              </div>

              <div id="newsContainer" class="news-grid">
                  <div class="loading">
                      <div class="spinner"></div>
                      <p>Loading news feed...</p>
                  </div>
              </div>
              
              <div id="viewMoreContainer" class="view-more-link hidden">
                  <a href="#" id="viewMoreLink">
                      View More
                      <i class="fas fa-arrow-right"></i>
                  </a>
              </div>
          </div>

          <div class="top-stories-section">
              <h2 class="top-stories-header">
                  <i class="fas fa-fire"></i>
                  Top Stories
              </h2>
              <div id="topStories" class="top-stories-grid">
                  <div class="top-story">
                      <span class="top-story-number">1</span>
                      <div class="top-story-content">
                          <div class="top-story-title">Loading top stories...</div>
                          <div class="top-story-meta">
                              <i class="far fa-clock"></i>
                              Just now
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    </main>
  </div>

    <div id="profile-menu" class="fixed inset-0 z-[120] hidden">
        <div id="profile-overlay" class="absolute inset-0 bg-black/40"></div>
        <div class="absolute right-4 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
            <div class="px-4 py-3 border-b border-slate-200">
                <div class="text-sm font-semibold text-slate-900">Account</div>
                <div id="profile-email" class="text-xs text-slate-500 truncate">—</div>
            </div>
            <div class="p-2">
                <a id="profile-settings" href="/demo/settings.html#basic" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
                    <i class="fa-regular fa-user text-slate-500 w-4"></i>
                    <span>Profile settings</span>
                </a>
                <button id="profile-logout" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
                    <i class="fa-solid fa-right-from-bracket w-4"></i>
                    <span>Sign out</span>
                </button>
            </div>
        </div>
    </div>

  <div id="articleModal" class="article-modal" aria-hidden="true">
      <div class="article-modal-content" role="dialog" aria-modal="true" aria-label="Story preview">
          <div class="article-modal-toolbar">
              <div class="article-modal-title">
                  <i class="fas fa-newspaper"></i>
                  <span>Alliance News Story</span>
              </div>
              <div class="article-modal-actions">
                  <button id="articleModalClose" type="button" class="article-modal-close" aria-label="Close story preview">
                      <i class="fas fa-times"></i>
                  </button>
              </div>
          </div>
          <iframe id="articleModalFrame" class="article-modal-frame" title="News story" sandbox="allow-scripts allow-same-origin allow-popups" referrerpolicy="no-referrer"></iframe>
          <div id="articleModalPreview" class="article-modal-frame article-modal-preview" style="display: none;"></div>
      </div>
  </div>

  <div id="subscribeModal" class="subscribe-modal" aria-hidden="true">
      <div class="subscribe-modal-content" role="dialog" aria-modal="true" aria-labelledby="subscribeModalTitle">
          <div class="subscribe-modal-header">
              <h2 id="subscribeModalTitle" class="subscribe-modal-title">
                  <i class="fas fa-bell"></i>
                  Newsletter Preferences
              </h2>
              <p class="subscribe-modal-subtitle">Choose when you'd like to receive market updates and insights</p>
          </div>
          <div class="subscribe-modal-body">
              <div class="subscribe-options">
                  <label class="subscribe-option">
                      <input type="checkbox" name="newsletter" value="morning-hive" id="morningHive">
                      <span class="subscribe-option-label">Morning Hive</span>
                  </label>
                  <label class="subscribe-option">
                      <input type="checkbox" name="newsletter" value="mid-day" id="midDay">
                      <span class="subscribe-option-label">Mid Day</span>
                  </label>
                  <label class="subscribe-option">
                      <input type="checkbox" name="newsletter" value="close" id="close">
                      <span class="subscribe-option-label">Close</span>
                  </label>
                  <label class="subscribe-option">
                      <input type="checkbox" name="newsletter" value="end-of-day" id="endOfDay">
                      <span class="subscribe-option-label">End of Day</span>
                  </label>
              </div>
          </div>
          <div class="subscribe-modal-footer">
              <button type="button" class="subscribe-btn subscribe-btn-secondary" id="subscribeCancelBtn">
                  Cancel
              </button>
              <button type="button" class="subscribe-btn subscribe-btn-primary" id="subscribeSubmitBtn">
                  Subscribe
              </button>
          </div>
      </div>
  </div>

    <script nonce="ALGOHIVE">
    // Mobile sidebar toggle
    (function () {
      const btn = document.getElementById('ah-mobile-menu-btn');
      const overlay = document.getElementById('ah-overlay');
      const sidebar = document.getElementById('ah-sidebar');

      function openMenu() {
        sidebar.classList.add('is-open');
        overlay.classList.remove('hidden');
      }
      function closeMenu() {
        sidebar.classList.remove('is-open');
        overlay.classList.add('hidden');
      }

      btn?.addEventListener('click', openMenu);
      overlay?.addEventListener('click', closeMenu);
      sidebar?.querySelectorAll('nav a, nav details a').forEach(link => link.addEventListener('click', closeMenu));
    })();
  </script>

    <script nonce="ALGOHIVE">
    // Desktop sidebar collapse memory
    (function () {
      const layout = document.getElementById('layout');
      const aside = document.getElementById('ah-sidebar');
      const btn = document.getElementById('ah-collapse');
      const saved = localStorage.getItem('ah_collapsed') === 'true';
      if (saved) { aside.setAttribute('data-collapsed', 'true'); layout.classList.add('is-collapsed'); }
      btn?.addEventListener('click', () => {
        const isCollapsed = aside.getAttribute('data-collapsed') === 'true';
        if (!isCollapsed) aside.querySelectorAll('details[open]').forEach(d => d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed));
        layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed));
      });
    })();
  </script>

        <script type="module" nonce="ALGOHIVE">
                import '/js/guard.js';
        </script>

    <script type="module" nonce="ALGOHIVE">
        import { supabase } from '/js/supabase.js';

        const PAGE_SIZE = 8;
        const newsContainer = document.getElementById('newsContainer');
        const viewMoreContainer = document.getElementById('viewMoreContainer');
        const viewMoreLink = document.getElementById('viewMoreLink');
        const topStoriesContainer = document.getElementById('topStories');
        const searchInput = document.getElementById('searchInput');
        const articleModal = document.getElementById('articleModal');
        const articleModalFrame = document.getElementById('articleModalFrame');
        const articleModalPreview = document.getElementById('articleModalPreview');
        const articleModalCloseBtn = document.getElementById('articleModalClose');
        const profileNameEl = document.getElementById('profile-name');
        const profileAvatarEl = document.getElementById('profile-avatar');
        const profileEmailEl = document.getElementById('profile-email');
        const profileBtn = document.getElementById('profile-btn');
        const profileMenu = document.getElementById('profile-menu');
        const profileOverlay = document.getElementById('profile-overlay');
        const profileLogoutBtn = document.getElementById('profile-logout');

        let loadedCount = 0;
        let totalCount = null;
        let isLoadingMore = false;
        let activeCategory = 'All News';
        let searchKeyword = '';
        let currentUser = null;
        let latestProfile = null;
        let displayName = '—';

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                activeCategory = tab.dataset.category || tab.textContent.trim();
                applyFilters();
            });
        });

        function computeDisplayName(user = {}, profile = {}) {
            const candidates = [
                profile?.full_name,
                [profile?.first_name, profile?.last_name].filter(Boolean).join(' '),
                user?.user_metadata?.full_name,
                [user?.user_metadata?.first_name, user?.user_metadata?.last_name].filter(Boolean).join(' '),
                user?.email
            ];
            const name = candidates.find(value => value && value.trim()) || '—';
            displayName = name;
            return name;
        }

        function buildFallbackAvatar(firstName = '', lastName = '', displayName = '') {
            const f = (firstName || '')[0]?.toUpperCase() || '';
            const l = (lastName || '')[0]?.toUpperCase() || '';
            const initials = f && l ? f + l : f ? f + f : displayName.substring(0, 2).toUpperCase() || 'U';
            const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='72' height='72'>
                <rect width='100%' height='100%' rx='36' ry='36' fill='#0f172a'/>
                <text x='50%' y='54%' text-anchor='middle' dominant-baseline='middle' font-family='Inter, Arial, sans-serif' font-size='22' font-weight='600' fill='#fff'>${initials}</text>
            </svg>`);
            return `data:image/svg+xml;utf8,${svg}`;
        }

        function syncProfileChrome(user = currentUser, profile = latestProfile) {
            const name = computeDisplayName(user || {}, profile || {});
            if (profileNameEl) profileNameEl.textContent = name;
            if (profileEmailEl) profileEmailEl.textContent = user?.email || name;
            if (profileAvatarEl) {
                const avatarUrl = profile?.avatar_url || user?.user_metadata?.avatar_url;
                const firstName = profile?.first_name || user?.user_metadata?.first_name || name.split(' ')[0] || '';
                const lastName = profile?.last_name || user?.user_metadata?.last_name || name.split(' ')[1] || '';
                profileAvatarEl.src = avatarUrl || buildFallbackAvatar(firstName, lastName, name);
            }
        }

        async function hydrateProfileChrome() {
            try {
                const { data: userWrap } = await supabase.auth.getUser();
                const user = userWrap?.user;
                if (!user) return null;

                currentUser = user;
                let profile = null;
                try {
                    const { data } = await supabase
                        .from('profiles')
                        .select('full_name,first_name,last_name,avatar_url')
                        .eq('id', user.id)
                        .maybeSingle();
                    profile = data || null;
                } catch (error) {
                    console.warn('Profile lookup failed', error);
                }

                latestProfile = profile;
                syncProfileChrome(user, profile);
                return user;
            } catch (error) {
                console.error('Failed to hydrate profile chrome', error);
                return null;
            }
        }

        function wireProfileMenu() {
            profileBtn?.addEventListener('click', () => {
                profileMenu?.classList.toggle('hidden');
            });
            profileOverlay?.addEventListener('click', () => profileMenu?.classList.add('hidden'));
            profileMenu?.addEventListener('click', (event) => {
                if (event.target === profileMenu) profileMenu.classList.add('hidden');
            });
            profileLogoutBtn?.addEventListener('click', async () => {
                try {
                    await supabase.auth.signOut();
                } catch (error) {
                    console.error('Sign out failed', error);
                } finally {
                    location.replace('/auth.html');
                }
            });
        }

        searchInput?.addEventListener('input', (event) => {
            searchKeyword = event.target.value.trim().toLowerCase();
            applyFilters();
        });

        const openArticleModal = (article) => {
            if (!article) return;
            if (!articleModal) return;

            // Set title
            const titleEl = articleModal.querySelector('.article-modal-title span');
            if (titleEl) titleEl.textContent = article.title || 'News Article';

            if (articleModalFrame) {
                articleModalFrame.style.display = 'none';
            }
            if (articleModalPreview) {
                articleModalPreview.style.display = 'block';
                renderArticlePreview(articleModalPreview, article);
            }

            articleModal.classList.add('is-visible');
            articleModal.setAttribute('aria-hidden', 'false');
        };

        const closeArticleModal = () => {
            if (!articleModal) return;
            if (articleModalFrame) {
                articleModalFrame.src = 'about:blank';
                articleModalFrame.style.display = 'block';
            }
            if (articleModalPreview) {
                articleModalPreview.style.display = 'none';
                articleModalPreview.innerHTML = '';
            }
            articleModal.classList.remove('is-visible');
            articleModal.setAttribute('aria-hidden', 'true');
        };

        articleModalCloseBtn?.addEventListener('click', closeArticleModal);
        articleModal?.addEventListener('click', (event) => {
            if (event.target === articleModal) closeArticleModal();
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') closeArticleModal();
        });

        viewMoreLink?.addEventListener('click', async (event) => {
            event.preventDefault();
            if (!isLoadingMore) await loadMoreNews();
        });

        function applyFilters() {
            const normalizedCategory = activeCategory.toLowerCase();
            const cards = document.querySelectorAll('.news-card');
            cards.forEach(card => {
                const cardCategory = (card.dataset.category || 'markets').toLowerCase();
                const matchesCategory = normalizedCategory === 'all news' || cardCategory === normalizedCategory;
                const searchableText = card.dataset.search || '';
                const matchesSearch = !searchKeyword || searchableText.includes(searchKeyword);
                card.style.display = matchesCategory && matchesSearch ? 'block' : 'none';
            });
        }

        async function fetchArticles(offset) {
            const { data, count, error } = await supabase
                .from('alliance_news_articles')
                .select('id,doc_id,source,channel,title,published_at,author,products,significance,content_types,companies,markets,economics,geography,industries,body_text', { count: 'exact' })
                .order('published_at', { ascending: false })
                .range(offset, offset + PAGE_SIZE - 1);

            if (error) throw error;
            if (typeof count === 'number') totalCount = count;
            return data || [];
        }

        function appendArticles(articles) {
            articles.forEach(article => {
                const card = createNewsCard(article);
                newsContainer?.appendChild(card);
            });
            loadedCount += articles.length;
            applyFilters();
        }

        function updateViewMoreVisibility(lastBatchLength) {
            if (!viewMoreContainer) return;
            const moreAvailable = totalCount === null ? lastBatchLength === PAGE_SIZE : loadedCount < totalCount;
            viewMoreContainer.classList.toggle('hidden', !moreAvailable);
        }

        async function loadInitialNews() {
            try {
                const articles = await fetchArticles(0);
                if (!articles.length) {
                    newsContainer.innerHTML = '<div class="error"><i class="fas fa-exclamation-circle"></i> No news items found</div>';
                    updateViewMoreVisibility(0);
                    return;
                }
                newsContainer.innerHTML = '';
                appendArticles(articles);
                updateViewMoreVisibility(articles.length);
            } catch (error) {
                console.error('Error loading news:', error);
                newsContainer.innerHTML = '<div class="error"><i class="fas fa-exclamation-circle"></i> Failed to load news articles</div>';
            }
        }

        async function loadMoreNews() {
            isLoadingMore = true;
            const originalLabel = viewMoreLink?.innerHTML;
            if (viewMoreLink) {
                viewMoreLink.innerHTML = 'Loading <i class="fas fa-circle-notch fa-spin"></i>';
                viewMoreLink.setAttribute('aria-busy', 'true');
            }
            try {
                const articles = await fetchArticles(loadedCount);
                if (!articles.length) {
                    updateViewMoreVisibility(0);
                    return;
                }
                appendArticles(articles);
                updateViewMoreVisibility(articles.length);
            } catch (error) {
                console.error('Error loading more news:', error);
            } finally {
                isLoadingMore = false;
                if (viewMoreLink) {
                    viewMoreLink.innerHTML = originalLabel || 'View More <i class="fas fa-arrow-right"></i>';
                    viewMoreLink.removeAttribute('aria-busy');
                }
            }
        }

        async function loadTopStories() {
            if (!topStoriesContainer) return;
            try {
                const { data: topStories, error } = await supabase
                    .from('alliance_news_articles')
                    .select('id,doc_id,source,channel,title,published_at,author,products,significance,content_types,companies,markets,economics,geography,industries,body_text')
                    .order('published_at', { ascending: false })
                    .limit(6);

                if (error) throw error;

                if (!topStories || !topStories.length) {
                    topStoriesContainer.innerHTML = '<p style="color: #9ca3af;">No top stories available</p>';
                    return;
                }

                topStoriesContainer.innerHTML = '';
                topStories.forEach((article, index) => {
                    const safeTitle = escapeHTML(article.title || 'Untitled');
                    const storyDiv = document.createElement('div');
                    storyDiv.className = 'top-story';
                    storyDiv.innerHTML = `
                        <span class="top-story-number">${index + 1}</span>
                        <div class="top-story-content">
                            <div class="top-story-title">${safeTitle}</div>
                            <div class="top-story-meta">
                                <i class="far fa-clock"></i>
                                ${getTimeAgo(new Date(article.published_at))}
                            </div>
                        </div>
                    `;
                    storyDiv.addEventListener('click', () => openArticleModal(article));
                    topStoriesContainer.appendChild(storyDiv);
                });
            } catch (error) {
                console.error('Error loading top stories:', error);
                topStoriesContainer.innerHTML = '<p style="color: #dc2626;">Failed to load top stories</p>';
            }
        }

        function createNewsCard(article) {
            const card = document.createElement('div');
            card.className = 'news-card';
            const derivedCategory = getArticleCategory(article);
            card.dataset.category = derivedCategory;
            const productTags = normaliseTags(article.products);
            const significanceTags = normaliseTags(article.significance);
            const contentTypeTags = normaliseTags(article.content_types);
            const companyTags = normaliseTags(article.companies);
            const marketTags = normaliseTags(article.markets);
            const industryTags = normaliseTags(article.industries);
            const economicTags = normaliseTags(article.economics);
            const geographyTags = normaliseTags(article.geography);
            card.dataset.search = [
                article.title,
                article.source,
                article.channel,
                article.author,
                article.body_text,
                ...companyTags,
                ...productTags,
                ...marketTags,
                ...industryTags,
                ...economicTags,
                ...geographyTags,
                ...significanceTags,
                ...contentTypeTags
            ].filter(Boolean).join(' ').toLowerCase();
            card.dataset.title = article.title || '';

            const date = new Date(article.published_at);
            const timeAgo = getTimeAgo(date);
            const primaryCompany = companyTags[0];
            const extraCompanies = companyTags.slice(1);
            const safeSource = escapeHTML(article.source || 'Alliance News');
            const safeTitle = escapeHTML(article.title || 'Untitled');
            const safePreview = escapeHTML(getPreviewText(article.body_text));
            const safeCategory = escapeHTML(derivedCategory);

            card.innerHTML = `
                <div class="news-source">
                    <i class="fas fa-newspaper"></i>
                    ${safeSource}
                </div>
                ${primaryCompany ? `<span class="news-ticker">${escapeHTML(primaryCompany)}</span>` : ''}
                ${extraCompanies.slice(0, 2).map(company => `<span class="news-ticker">${escapeHTML(company)}</span>`).join('')}
                <div class="news-title">${safeTitle}</div>
                <p style="font-size: 14px; color: #6b7280; line-height: 1.6; margin: 12px 0;">${safePreview}</p>
                <div class="news-meta">
                    <div class="news-time">
                        <i class="far fa-clock"></i>
                        <span>${timeAgo}</span>
                    </div>
                    <div class="news-time">
                        <i class="fas fa-chart-line"></i>
                        <span>${safeCategory}</span>
                    </div>
                </div>
            `;

            card.addEventListener('click', () => openArticleModal(article));
            return card;
        }

        const ALLIANCE_CODE_LABELS = {
            AGSPRO: 'Alliance News Global 500',
            ALLPRO: 'Alliance News UK Professional',
            ALLWEB: 'Alliance News UK Investor',
            AISPRO: 'Alliance News Italian Service Professional',
            AISWEB: 'Alliance News Italian Service Selection',
            ASAPRO: 'Alliance News South Africa Professional',
            ASAWEB: 'Alliance News South Africa Investor',
            ALLTOP: 'Top News',
            ALLSIG: 'Significant',
            ALLPOS: 'Positive',
            ALLNEG: 'Negative',
            ALLEXL: 'ALL Exclusive',
            ALLBRF: 'Briefing',
            ALLCAL: 'Calendar',
            ALLXTR: 'Extra',
            ALLFLS: 'Flash Headline',
            ALLDEP: 'In Depth',
            ALLMED: 'Media Pickup',
            ALLRPT: 'Repeat',
            ALLSUM: 'Summary',
            ALLTBL: 'Tabular Content',
            ALLENL: 'English Language',
            ALLITL: 'Italian Language',
            ALLCOS: 'All Company News',
            ALLERN: 'Earnings',
            ALLPRE: 'Earnings Preview',
            ALLOUT: 'Company Outlook',
            ALLSAL: 'Sales and Production',
            ALLTST: 'Testing and Test Results',
            ALLEXX: 'Executive Change',
            ALLCON: 'Contracts and JVs',
            ALLSUE: 'Litigation',
            ALLPDT: 'Product News',
            ALLRGC: 'Company Regulation',
            ALLPDR: 'Consumer Product Regulation',
            ALLCMA: 'Competition Regulation',
            ALLFRG: 'Financial Service Regulation',
            ALLPLN: 'Land Use Regulation',
            ALLESG: 'ESG Regulation',
            ALLENV: 'Environmental Regulation',
            ALLSOC: 'Social Regulation',
            ALLGVR: 'Governance Regulation',
            ALLACT: 'Corporate Action',
            ALLMNA: 'Merger and Acquisition',
            ALLISS: 'Stock and Bond Transactions',
            ALLIPO: 'IPOs',
            ALLDIV: 'Dividend and Buybacks',
            ALLEXS: 'Director Dealings',
            ALLFIN: 'Financing',
            ALLSCT: 'Restructuring',
            ALLMKT: 'All Markets News',
            ALLMRP: 'Stock Markets',
            ALLKNO: 'In The Know',
            ALLTAK: 'Taking AIM',
            ALLRAT: 'Broker Ratings',
            ALLMOV: 'Winners & Losers',
            ALLIDX: 'Index Changes',
            ALLBON: 'Bond Markets',
            ALLFRX: 'Forex Markets',
            ALLCOM: 'Commodities Markets',
            ALLECO: 'All Economic News',
            ALLDTA: 'Economic Indicators',
            ALLGOV: 'Government Policy',
            ALLCBK: 'Central Banks',
            ALLSOV: 'Sovereign Debt',
            ASX20: 'ASX 20',
            AISMTA: 'Borsa Italiana MTA',
            CAC40: 'CAC 40',
            DAX40: 'DAX 40',
            DOW30: 'Dow Jones Industrial Average',
            EURSTX: 'EuroStoxx',
            ALL100: 'FTSE 100',
            ALL250: 'FTSE 250',
            AISAIM: 'FTSE Italia Growth',
            AISMID: 'FTSE Italia Mid Cap',
            AISSMA: 'FTSE Italia Small Cap',
            ASAASI: 'FTSE JSE All-Share',
            ASAFLE: 'FTSE JSE Fledgling',
            ASAMID: 'FTSE JSE Mid Cap',
            ASASMA: 'FTSE JSE Small Cap',
            ASA40: 'FTSE JSE Top 40',
            AISMIB: 'FTSE MIB',
            ALLISE: 'Irish Stock Exchange',
            ALLAIM: 'London AIM',
            ALLAQS: 'London Aquis Stock Exchange',
            ALLFTA: 'London Main Market',
            MDAX: 'MDAX',
            NDQ100: 'Nasdaq 100',
            SMI20: 'SMI 20',
            STXE50: 'Stoxx 50',
            STX150: 'Stoxx Global 150',
            TECDAX: 'TecDAX',
            ALL1: 'Energy',
            ALL530: 'Non-Renewable Energy',
            ALL570: 'Oil Equipment, Drilling & Other Services',
            ALL580: 'Renewable Energy',
            ALL1000: 'Basic Resources',
            ALL1350: 'Chemicals',
            ALL1730: 'Industrial Materials',
            ALL1750: 'Industrial Metals & Mining',
            ALL1770: 'Precious Metals & Mining',
            ALL2000: 'Industrials',
            ALL2350: 'Construction & Materials',
            ALL2710: 'Aerospace & Defense',
            ALL2720: 'General Industrials',
            ALL2730: 'Electronic & Electrical Equipment',
            ALL2750: 'Industrial Engineering',
            ALL2770: 'Industrial Transportation',
            ALL2790: 'Support Services',
            ALL3000: 'Consumer Discretionary',
            ALL3350: 'Automobiles & Parts',
            ALL3700: 'Consumer Services',
            ALL3720: 'Household Goods & Home Construction',
            ALL3740: 'Leisure Goods',
            ALL3760: 'Personal Goods',
            ALL3550: 'Media',
            ALL3370: 'General Retailers',
            ALL3750: 'Travel & Leisure',
            ALL5000: 'Consumer Staples',
            ALL5530: 'Beverages',
            ALL5570: 'Food Producers',
            ALL5780: 'Tobacco',
            ALL5330: 'Personal Care, Drug & Grocery Stores',
            ALL4000: 'Health Care',
            ALL4530: 'Health Care Equipment & Services',
            ALL4570: 'Pharmaceuticals & Biotechnology',
            ALL4510: 'Health Care Providers',
            ALL6000: 'Telecommunications',
            ALL6530: 'Telecommunications Service Providers',
            ALL6540: 'Telecommunications Equipment',
            ALL7000: 'Utilities',
            ALL7530: 'Electricity',
            ALL7570: 'Gas, Water & Multiutilities',
            ALL7535: 'Waste & Disposal Services',
            ALL8000: 'Financials',
            ALL8350: 'Banks',
            ALL8570: 'Life Insurance',
            ALL8530: 'Nonlife Insurance',
            ALL8770: 'Financial Services',
            ALL8302: 'Open End and Miscellaneous Investment Vehicles',
            ALL8980: 'Equity Investment Trusts',
            ALL8990: 'Nonequity Investment Instruments',
            ALL8600: 'Real Estate',
            ALL8630: 'Real Estate Investment & Services',
            ALL8670: 'Real Estate Investment Trusts',
            ALL9000: 'Technology',
            ALL9530: 'Software & Computer Services',
            ALL9570: 'Technology Hardware & Equipment',
            ALLAME: 'Americas',
            ALLCAN: 'Canada',
            ALLUSA: 'US',
            ALLAPA: 'Asia Pacific',
            ALLAUS: 'Australia',
            ALLCHI: 'China',
            ALLIND: 'India',
            ALLJPA: 'Japan',
            ALLNZE: 'New Zealand',
            ALLEUR: 'Europe',
            ALLFRA: 'France',
            ALLEUO: 'European Union',
            ALLGER: 'Germany',
            ALLIRE: 'Ireland',
            ALLITA: 'Italy',
            ALLRUS: 'Russia',
            ALLSGP: 'Singapore',
            ALLESP: 'Spain',
            ALLSWZ: 'Switzerland',
            ALLUK: 'UK',
            ALLMEA: 'Middle East North Africa',
            ALLAFR: 'Sub-Saharan Africa',
            ALLSAF: 'South Africa',
            ALLPAG11: 'UK earnings, trading statements calendar',
            ALLPAG12: 'UK dividends calendar',
            ALLPAG13: 'UK shareholder meetings calendar',
            ALLPAG14: 'Global economic events calendar',
            ALLPAG16: 'Major economy comparative indicators',
            ALLPAG118: 'Get Ready for earnings or economic indicators',
            ALLPAG119: 'Calendario eventi societari italiani',
            ALLPAG122: 'South Africa company events calendar',
            ALLPAG123: 'Global company events calendar',
            ALLPAG22: 'LONDON BROKER RATINGS',
            ALLPAG23: 'LONDON SMALL-CAP WINNERS & LOSERS',
            ALLPAG24: 'LONDON AIM WINNERS & LOSERS',
            ALLPAG25: 'MILAN AIM WINNERS & LOSERS',
            ALLPAG26: 'MILAN BROKER RATINGS SUMMARY',
            ALLPAG27: 'MILAN SMALL-CAP WINNERS & LOSERS',
            ALLPAG29: 'GLOBAL BROKER RATINGS SUMMARY',
            ALLPAG211: 'MILAN SHORT POSITIONS',
            ALLPAG31: 'LONDON MARKET comment',
            ALLPAG32: 'MILAN MARKET comment',
            ALLPAG33: 'JOHANNESBURG MARKET comment',
            ALLPAG34: 'NEW YORK MARKET comment',
            ALLPAG41: 'LONDON BRIEFING',
            ALLPAG42: 'AFFARI IN PIAZZA',
            ALLPAG45: 'GLOBAL BRIEFING',
            ALLPAG53: 'IPO statistics: London Main Market',
            ALLPAG54: 'IPO statistics: London AIM and AQSE markets',
            ALLPAG61: 'US Federal Reserve Preview',
            ALLPAG62: 'Bank of England Preview',
            ALLPAG63: 'European Central Bank Preview',
            ALLPAG64: 'South African Reserve Bank Preview',
            ALLPAG71: 'FOREX MARKET: SA',
            ALLPAG72: 'FOREX MARKET: IS',
            ALLPAG73: 'FOREX MARKET: Global UK',
            ALLPAG74: 'COMMODITIES MARKET: Global UK SA',
            ALLPAG75: 'GOLD MARKET: IS',
            ALLPAG76: 'OIL MARKET: IS',
            ALLPAG81: 'BOND MARKET: SA',
            ALLPAG82: 'BOND MARKET: IS',
            ALLPAG91: 'Alliance News UK - start Of day',
            ALLPAG92: 'Alliance News IS - messaggio di apertura',
            ALLPAG93: 'Alliance News South Africa - start of day',
            ALLPAG94: 'Alliance News Global 500 - start Of day'
        };

        function resolveAllianceCode(value) {
            if (!value) return value;
            if (ALLIANCE_CODE_LABELS[value]) return ALLIANCE_CODE_LABELS[value];
            if (/^ALL\./.test(value)) return `Company Code (${value})`;
            if (/^AIS\./.test(value)) return `Company Code (${value})`;
            if (/^ASA\./.test(value)) return `Company Code (${value})`;
            if (value.includes('=ABOUT')) return `Primary Ticker (${value})`;
            return value;
        }

        function normaliseTags(value) {
            const tags = Array.isArray(value)
                ? value
                : typeof value === 'string'
                    ? value.split(',').map(t => t.trim())
                    : [];
            return tags.filter(Boolean).map(tag => resolveAllianceCode(tag));
        }

        function renderArticlePreview(container, article) {
            container.innerHTML = '';

            const category = getArticleCategory(article);
            const meta = document.createElement('div');
            meta.className = 'article-modal-meta';
            const author = article.author ? `By ${escapeHTML(article.author)}` : null;
            meta.innerHTML = `
                <span>${escapeHTML(article.source || 'Alliance News')}</span>
                <span>&middot;</span>
                <span>${escapeHTML(category)}</span>
                ${author ? `<span>&middot;</span><span>${author}</span>` : ''}
                <span>&middot;</span>
                <span>${getTimeAgo(new Date(article.published_at || Date.now()))}</span>
            `;
            container.appendChild(meta);

            const bodyText = article.body_text || 'No story content available.';
            appendArticleParagraphs(container, bodyText);
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((Date.now() - date.getTime()) / 1000);
            if (seconds < 60) return `${seconds}s ago`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function appendArticleParagraphs(container, text) {
            const segments = String(text || '')
                .split(/\n{2,}/)
                .map(segment => segment.trim())
                .filter(Boolean);

            if (!segments.length) segments.push('No story content available.');

            segments.forEach(segment => {
                const paragraph = document.createElement('p');
                paragraph.textContent = segment;
                container.appendChild(paragraph);
            });
        }

        function escapeHTML(value = '') {
            return String(value).replace(/[&<>"']/g, (char) => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            })[char] || char);
        }

        function getPreviewText(bodyText = '') {
            const cleaned = String(bodyText || '').replace(/\s+/g, ' ').trim();
            if (!cleaned) return 'Click to read more...';
            if (cleaned.length <= 180) return cleaned;
            return `${cleaned.slice(0, 177)}...`;
        }

        function getArticleCategory(article) {
            const fallbacks = [
                article.channel,
                normaliseTags(article.markets)[0],
                normaliseTags(article.industries)[0],
                normaliseTags(article.products)[0],
                normaliseTags(article.economics)[0],
                normaliseTags(article.geography)[0],
                normaliseTags(article.companies)[0]
            ].filter(Boolean);
            return fallbacks[0] || 'Markets';
        }

        async function initPage() {
            await hydrateProfileChrome();
            wireProfileMenu();
            await loadInitialNews();
            await loadTopStories();
        }

        initPage();
    </script>

    <script nonce="ALGOHIVE">
    // Subscribe modal functionality
    (function () {
      const subscribeLink = document.getElementById('subscribeLink');
      const subscribeModal = document.getElementById('subscribeModal');
      const subscribeCancelBtn = document.getElementById('subscribeCancelBtn');
      const subscribeSubmitBtn = document.getElementById('subscribeSubmitBtn');

      function openSubscribeModal(event) {
        event.preventDefault();
        subscribeModal.classList.add('is-visible');
        subscribeModal.setAttribute('aria-hidden', 'false');
      }

      function closeSubscribeModal() {
        subscribeModal.classList.remove('is-visible');
        subscribeModal.setAttribute('aria-hidden', 'true');
      }

      function handleSubscribe() {
        const checkboxes = document.querySelectorAll('#subscribeModal input[type="checkbox"]:checked');
        const selections = Array.from(checkboxes).map(cb => cb.value);
        
        if (selections.length === 0) {
          alert('Please select at least one newsletter option');
          return;
        }
        
        console.log('Subscribed to:', selections);
        // TODO: Send subscription data to backend
        alert('Thank you for subscribing! You will receive: ' + selections.join(', '));
        closeSubscribeModal();
      }

      subscribeLink?.addEventListener('click', openSubscribeModal);
      subscribeCancelBtn?.addEventListener('click', closeSubscribeModal);
      subscribeSubmitBtn?.addEventListener('click', handleSubscribe);
      
      subscribeModal?.addEventListener('click', (event) => {
        if (event.target === subscribeModal) closeSubscribeModal();
      });
      
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && subscribeModal.classList.contains('is-visible')) {
          closeSubscribeModal();
        }
      });
    })();
    </script>
</body>
</html>
