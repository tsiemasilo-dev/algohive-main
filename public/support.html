<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive — Support</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root {
      --page: #0b1220;
      --bg: #ffffff;
      --muted: #64748b;
      --ink: #0f172a;
      --olive: #7e8d52;
      --brand: #f59e0b;
      --line: #e2e8f0;
    }

    html,
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      height: 100%;
      scroll-behavior: smooth;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      height: 40px;
      padding: 0 .875rem;
      border-radius: 10px;
      border: 1px solid var(--line);
      font-weight: 600
    }

    .input {
      height: 40px;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 0 .75rem
    }

    /* UPDATED FOR RESPONSIVENESS */
    #layout {
      --sb: 220px;
      display: grid;
      grid-template-columns: 1fr;
      /* Mobile-first: 1 column */
      min-height: 100vh
    }

    #ah-sidebar {
      transition: transform .3s ease, width .2s ease;
      width: 280px;
      /* Mobile width */
      max-width: 85vw;
      position: fixed;
      /* Mobile overlay */
      z-index: 50;
      height: 100vh;
      transform: translateX(-100%);
      /* Hidden by default */
    }

    #ah-sidebar.is-open {
      transform: translateX(0);
      /* Show sidebar */
    }

    /* Desktop styles */
    @media (min-width: 768px) {
      #layout {
        grid-template-columns: var(--sb) 1fr
          /* 2-col grid on desktop */
      }

      #layout.is-collapsed {
        --sb: 64px
      }

      #ah-sidebar {
        position: sticky;
        /* Back to sticky */
        top: 0;
        width: var(--sb);
        /* Use variable width */
        max-width: none;
        transform: translateX(0);
        /* Always visible */
        z-index: auto;
      }
    }

    /* END RESPONSIVE UPDATES */

    #layout.is-collapsed {
      --sb: 64px
    }

    #ah-sidebar[data-collapsed="true"] .label,
    #ah-sidebar[data-collapsed="true"] .chevron {
      display: none
    }

    #ah-sidebar[data-collapsed="true"] details>.sub {
      display: none !important
    }

    #ah-sidebar[data-collapsed="true"] nav a,
    #ah-sidebar[data-collapsed="true"] details>summary {
      justify-content: center;
      gap: .25rem
    }

    #ah-sidebar .footer {
      transition: all .2s ease
    }

    #ah-sidebar[data-collapsed="true"] .footer {
      justify-content: center;
      flex-direction: column;
      gap: 12px
    }

    .btn-collapse :is(svg, i) {
      transition: transform .25s ease
    }

    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg, i) {
      transform: rotate(180deg)
    }

    /* Hide desktop collapse button on mobile */
    #ah-collapse {
      display: none;
    }

    @media (min-width: 768px) {
      #ah-collapse {
        display: inline-flex;
      }

      /* Show on desktop */
    }

    .btn-olive {
      background: var(--olive);
      color: #fff;
      border: 0;
    }

    .btn-olive:hover {
      filter: brightness(0.92);
    }

    /* Accordion styles */
    .accordion-item details[open] summary {
      font-weight: 600;
      color: var(--olive);
    }

    .accordion-item details summary {
      transition: color 0.2s ease;
    }

    .accordion-item details summary::-webkit-details-marker {
      display: none;
    }

    .accordion-item details summary::after {
      content: '\f078';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      float: right;
      transition: transform 0.2s ease;
    }

    .accordion-item details[open] summary::after {
      transform: rotate(180deg);
    }

    /* NEW: Digital Stopwatch Display Styles */
    @font-face {
        font-family: 'Digital-7 Mono';
        src: url('https://fonts.cdnfonts.com/s/43424/digital-7%20(mono).woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }
    
    .digital-display {
      font-family: 'Digital-7 Mono', monospace; /* Will use a fallback if not available */
      font-size: 3.5rem; /* Larger font size */
      font-weight: normal; /* Digital fonts are usually not bold */
      color: #000000; /* Black color */
      letter-spacing: -3px; /* Tighter spacing for digital look */
      line-height: 1;
      text-align: center;
      display: flex; /* To align minutes and seconds */
      justify-content: center;
      align-items: center;
      margin-top: 1rem;
      position: relative;
    }

    .digital-display span {
      position: relative;
      padding: 0 5px; /* Add some padding around digits */
    }

    .digital-display span::before {
      content: '88'; /* Ghosting effect for unlit segments */
      position: absolute;
      color: rgba(0, 0, 0, 0.1); /* Faded black for unlit segments */
      left: 0;
      top: 0;
      width: 100%;
      text-align: center;
    }

    .digital-display span:first-child::before { content: '00'; } /* Minutes ghost */
    .digital-display span:last-child::before { content: '88'; }  /* Seconds ghost */


    /* Animation for attention - fade */
    @keyframes fade-timer {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .digital-display.active-warning {
      animation: fade-timer 1.5s infinite linear; /* Apply animation when active */
    }

    /* Keep the pop-up centered and visible */
    #session-timeout-modal .modal-content-custom {
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90vw;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    /* END: Digital Stopwatch Styles */

    @media (min-width: 768px) and (max-width: 1023px) {
      #layout { grid-template-columns: 1fr; }
      #layout.is-collapsed { --sb: 275px; }
      #ah-sidebar {
        position: fixed;
        top: 0;
        width: 350px;
        max-width: 85vw;
        height: 100vh;
        transform: translateX(-100%);
        z-index: 50;
      }
      #ah-sidebar.is-open { transform: translateX(0); }
      #ah-collapse { display: none; }
      #ah-mobile-menu-btn { display: inline-flex !important; }
      #ah-overlay { display: none; }
      #ah-overlay:not(.hidden) { display: block; }
    }
  </style>
  <script nonce="ALGOHIVE">
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>

<body class="min-h-screen overflow-x-hidden">
  <div id="layout">
    <div id="ah-overlay" class="fixed inset-0 bg-black/40 z-40 hidden md:hidden"></div>
    <aside id="ah-sidebar" data-collapsed="false"
      class="border-r border-slate-200 h-[100vh] bg-white flex flex-col overflow-hidden">
      <div class="px-4 py-4 flex items-center gap-3 border-b border-slate-200">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png"
          alt="AlgoHive Logo" class="w-10 h-10 object-contain" />
        <div class="min-w-0">
          <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
          <div class="text-[11px] text-slate-500 label">Where Smart Capital Gathers</div>
        </div>
      </div>

      <nav id="main-nav" class="p-2 text-[14px] flex-1 overflow-y-auto">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900"
          href="/home.html" title="Home">
          <i class="fa-solid fa-house text-slate-500 w-4 shrink-0"></i><span class="label">Home</span>
        </a>

        <details class="group mt-1">
          <summary
            class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-regular fa-user w-4 text-slate-500"></i><span class="label">Portfolio</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/my-strategies.html"><i
                class="fa-solid fa-chart-pie w-4 text-slate-500"></i><span class="label">My Strategies</span></a>
          </div>
        </details>

        <details class="group mt-1">
          <summary
            class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-solid fa-link w-4 text-slate-500"></i><span class="label">Invest</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="strategies.html"><i
                class="fa-solid fa-chart-line w-4 text-slate-500"></i><span class="label">OpenStrategies</span></a>


          </div>
        </details>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="news-insights.html"><i
            class="fa-solid fa-newspaper w-4 text-slate-500"></i><span class="label">News &amp; Insights</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-slate-100 font-semibold text-olive-600"
          href="support.html"><i class="fa-solid fa-life-ring w-4 text-slate-500"></i><span
            class="label">Support</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="legal.html"><i
            class="fa-solid fa-scale-balanced w-4 text-slate-500"></i><span class="label">Legal</span></a>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <a href="settings.html" id="ah-settings" class="btn btn-settings h-10 w-10 p-0 rounded-xl" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </a>
        <button id="ah-collapse"
          class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <main class="flex-1 min-w-0 bg-slate-50">
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <button id="ah-mobile-menu-btn" class="md:hidden btn h-10 w-10 p-0 rounded-xl border-0" title="Open Menu">
            <i class="fa-solid fa-bars"></i>
          </button>
          <div class="relative w-full hidden md:block max-w-[460px]">
            <input id="search-bar" class="input w-full pl-9" placeholder="Search support..." />
            <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.3-4.3" />
            </svg>
          </div>
        </div>



  
<div class="flex items-center gap-3">
          <img id="hdr-avatar"
            src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>"
            alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200" />
          <button id="hdr-profile-btn" class="flex items-center gap-2 text-slate-900 font-medium hover:text-slate-700">
            <span id="hdr-name" class="hidden lg:inline-block lg:truncate lg:max-w-xs">—</span>
            <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
          </button>
        </div>
      </div>
      


        <section id="support-content" class="px-6 py-8">
        <div class="max-w-4xl mx-auto">

          <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-slate-900">AlgoHive Support</h1>
            <p class="mt-4 text-lg text-slate-600">Welcome to AlgoHive Support! Here you’ll find guides, FAQs, and
              direct assistance to help you make the most of your trading experience.</p>
          </div>

          <div id="no-results" class="hidden text-center my-8">
            <p class="text-slate-600 text-lg">No results found for your search.</p>
          </div>

          <div id="getting-started" class="searchable-section mb-12">
            <h2 class="text-2xl font-semibold text-slate-900 border-b pb-3 mb-6">Getting Started</h2>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-white p-6 rounded-lg border border-slate-200 searchable-content">
                <h3 class="font-semibold text-lg text-slate-800">1. Verify Your Identity (KYC)</h3>
                <p class="text-slate-600 mt-2">Before you can invest, you must verify your identity. This is a secure process (KYC) done via our partner, Didit. You will be prompted to scan your ID (like a National ID card or Driver's License) and take a quick selfie. This one-time step is required for security and compliance.</p>
              </div>
              <div class="bg-white p-6 rounded-lg border border-slate-200 searchable-content">
                <h3 class="font-semibold text-lg text-slate-800">2. Explore OpenStrategies</h3>
                <p class="text-slate-600 mt-2">Once verified, head to the "Invest" &gt; "OpenStrategies" page. Here you can browse, filter, and compare all available investment strategies. Click on any strategy to view its detailed factsheet, performance, and risk level.</p>
              </div>
              <div class="bg-white p-6 rounded-lg border border-slate-200 searchable-content">
                <h3 class="font-semibold text-lg text-slate-800">3. Allocate & Invest</h3>
                <p class="text-slate-600 mt-2">Found a strategy you like? On the factsheet page, use the "Allocate to Strategy" widget. Enter the amount (in Rands) or the number of units you wish to purchase and click "Allocate". You'll be guided through a secure payment process via Paystack.</p>
              </div>
              <div class="bg-white p-6 rounded-lg border border-slate-200 searchable-content">
                <h3 class="font-semibold text-lg text-slate-800">4. Monitor Your Portfolio</h3>
                <p class="text-slate-600 mt-2">All your investments are visible on the "Portfolio" &gt; "My Strategies" page. Here you can track your total value, performance, and manage your holdings in one place.</p>
              </div>
            </div>
          </div>

          <div id="faq" class="searchable-section mb-12">
            <h2 class="text-2xl font-semibold text-slate-900 border-b pb-3 mb-6">Frequently Asked Questions</h2>
            <div class="space-y-4">
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    What is AlgoHive?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    AlgoHive is a platform where you can discover, track and allocate to managed strategies across asset classes, paying only performance and transaction fees instead of AUM fees.
                  </div>
                </details>
              </div>
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    How do fees work?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    You only pay performance fees when strategies deliver returns. A small transaction fee applies when you allocate or rebalance. There are no AUM fees — we only win when you do.
                  </div>
                </details>
              </div>
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    Can I track multiple strategies?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    Yes. On the Freemium plan you can track one strategy. The Basic plan allows up to six, and Premium unlocks unlimited tracking.
                  </div>
                </details>
              </div>
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    Do you offer advisory or just tools?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    Yes. Alongside our tools and data, you can book sessions with certified wealth advisors for personalised financial advice.
                  </div>
                </details>
              </div>
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    Where is my data stored?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    Encrypted at rest and in transit with reputable cloud providers. You control connections and revocations.
                  </div>
                </details>
              </div>
              
              <div class="accordion-item searchable-content">
                <details>
                  <summary class="cursor-pointer font-medium text-slate-800 p-4 bg-white rounded-lg border border-slate-200">
                    Can I cancel anytime?</summary>
                  <div class="p-4 bg-white border border-t-0 border-slate-200 rounded-b-lg text-slate-600">
                    Yep. Plans are month-to-month. You can downgrade or cancel from your account settings.
                  </div>
                </details>
              </div>

            </div>
          </div>

          <div id="contact" class="mb-12 bg-white p-8 rounded-lg border border-slate-200">
            <h2 class="text-2xl font-semibold text-slate-900">Contact Support</h2>
            <p class="text-slate-600 mt-2">Still can't find what you're looking for? Get in touch with our support team.
            </p>
            <form id="contact-form" class="mt-6">
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label for="contact-name" class="text-sm font-medium text-slate-700">Your Name</label>
                  <input type="text" id="contact-name" class="input w-full mt-1" required>
                </div>
                <div>
                  <label for="contact-email" class="text-sm font-medium text-slate-700">Your Email</label>
                  <input type="email" id="contact-email" class="input w-full mt-1" required>
                </div>
              </div>
              <div class="mt-4">
                <label for="contact-subject" class="text-sm font-medium text-slate-700">Subject</label>
                <select id="contact-subject" class="input w-full mt-1">
                  <option>General Inquiry</option>
                  <option>Technical Issue</option>
                  <option>Billing Question</option>
                  <option>Strategy Setup</option>
                </select>
              </div>
              <div class="mt-4">
                <label for="contact-message" class="text-sm font-medium text-slate-700">Message</label>
                <textarea id="contact-message" rows="4" class="input w-full mt-1 !h-auto" required></textarea>
              </div>
              <div class="mt-6">
                <button type="submit" class="btn btn-olive">Send Email</button>
              </div>
            </form>
          </div>

          <div id="legal" class="text-center text-sm text-slate-500">
            <a href="legal.html#terms" class="hover:underline">Terms & Conditions</a> &bull;
            <a href="legal.html#privacy" class="hover:underline">Privacy Policy</a> &bull;
            <a href="legal.html#risk" class="hover:underline">Risk Disclaimer</a>
          </div>

        </div>
      </section>
    </main>
  </div>

  <div id="profile-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute right-6 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200">
        <div class="text-sm font-semibold text-slate-900">Account</div>
        <div id="pm-email" class="text-xs text-slate-500 truncate">user@example.com</div>
      </div>
      <div class="p-2">
        <a id="pm-profile" href="/settings.html#basic" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
          <i class="fa-regular fa-user text-slate-500 w-4"></i>
          <span>Profile settings</span>
        </a>
        <button id="pm-logout" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
          <i class="fa-solid fa-right-from-bracket w-4"></i>
          <span>Log out</span>
        </button>
      </div>
    </div>
  </div>

  <div id="session-timeout-modal" class="fixed inset-0 z-[600] hidden p-6 grid place-items-center backdrop-blur-lg bg-black/40">
    <div class="relative w-full max-w-md rounded-2xl border border-slate-300 bg-white p-8 shadow-2xl text-center">
      <h2 class="text-xl font-semibold text-slate-900">Are you still there?</h2>
      <p class="text-slate-600 mt-2">
        You've been inactive for a while. You will be automatically logged out in
        <div id="session-countdown" class="digital-display mt-4">
          <span id="countdown-minutes">00</span>:<span id="countdown-seconds">60</span>
        </div>
         seconds for security.
      </p>
      <button
        id="session-stay-btn"
        class="mt-6 inline-flex h-10 px-6 rounded-lg items-center justify-center font-medium
               bg-[var(--olive)] text-white hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-[var(--olive)]/40"
      >
        I'm still here
      </button>
    </div>
  </div>
  <script nonce="ALGOHIVE">
    // Sidebar collapse memory
    (function () {
      const layout = document.getElementById('layout');
      const aside = document.getElementById('ah-sidebar');
      const btn = document.getElementById('ah-collapse');
      const saved = localStorage.getItem('ah_collapsed') === 'true';
      if (saved) { aside.setAttribute('data-collapsed', 'true'); layout.classList.add('is-collapsed'); }
      btn?.addEventListener('click', () => {
        const isCollapsed = aside.getAttribute('data-collapsed') === 'true';
        if (!isCollapsed) aside.querySelectorAll('details[open]').forEach(d => d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed));
        layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed));
      });
    })();

    // Search functionality
    const searchBar = document.getElementById('search-bar');
    const searchableContent = document.querySelectorAll('.searchable-content');
    const searchableSections = document.querySelectorAll('.searchable-section');
    const noResults = document.getElementById('no-results');

    searchBar.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      let resultsFound = false;

      searchableContent.forEach(content => {
        const text = content.textContent.toLowerCase();
        const isVisible = text.includes(query);
        content.style.display = isVisible ? '' : 'none';
        if (isVisible) resultsFound = true;
      });

      searchableSections.forEach(section => {
        const hasVisibleContent = section.querySelector('.searchable-content:not([style*="display: none"])');
        section.style.display = hasVisibleContent ? '' : 'none';
      });

      noResults.style.display = resultsFound ? 'none' : 'block';
    });

    // Contact form mailto link
    const contactForm = document.getElementById('contact-form');
    contactForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('contact-name').value;
      const email = document.getElementById('contact-email').value;
      const subject = document.getElementById('contact-subject').value;
      const message = document.getElementById('contact-message').value;

      const body = `Name: ${name}%0D%0AEmail: ${email}%0D%0A%0D%0AMessage:%0D%0A${message}`;

      window.location.href = `mailto:support@algohive.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    });
  </script>

  <script nonce="ALGOHIVE">
    // Mobile menu script
    (function () {
      const btn = document.getElementById('ah-mobile-menu-btn');
      const overlay = document.getElementById('ah-overlay');
      const sidebar = document.getElementById('ah-sidebar');

      function openMenu() {
        sidebar.classList.add('is-open');
        overlay.classList.remove('hidden');
      }
      function closeMenu() {
        sidebar.classList.remove('is-open');
        overlay.classList.add('hidden');
      }

      btn?.addEventListener('click', openMenu);
      overlay?.addEventListener('click', closeMenu);

      sidebar?.querySelectorAll('nav a, nav details a').forEach(link => {
        link.addEventListener('click', closeMenu);
      });
    })();
  </script>

  <script type="module" nonce="ALGOHIVE">
    import { supabase } from "/js/supabase.js"; 

    // --- tiny helpers ---
    const BLANK_AVATAR = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>";
    const setText = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v ?? "—"; };
    const setSrc = (id, v) => { const el = document.getElementById(id); if (el) el.src = v || BLANK_AVATAR; };

    // === [NEW] PROFILE GATING HELPERS (from home.html) ===
    const REQUIRED_PROFILE_FIELDS = [
      "first_name", "last_name", "phone", "dob", "id_number", "nationality",
      "country_residence", "employment_status", "occupation", "employer",
      "income_bracket", "source_of_funds", "net_worth_range", "experience_level",
      "risk_tolerance", "objectives",
    ];
    const hasValue = (value) => String(value ?? "").trim().length > 0;
    const computeProfileComplete = (row) =>
      REQUIRED_PROFILE_FIELDS.every((key) => hasValue(row?.[key]));

    function resolveKycBoolean(row) {
      const v = row?.kyc_status;
      if (typeof v === "boolean") return v;
      if (typeof v === "string")
        return ["verified", "approved", "done", "passed", "kyc_done"].includes(
          v.toLowerCase()
        );
      return false;
    }
    function gateBannerMessage(profileComplete, kycDone) {
      if (!profileComplete && !kycDone)
        return "Please finish Additional Info and complete KYC first.";
      if (!profileComplete) return "Please finish Additional Info first.";
      if (!kycDone) return "Please complete KYC first.";
      return "";
    }
    // === [END NEW GATING HELPERS] ===

    // === [NEW] SESSION TIMEOUT FUNCTION (Black, Fading) ===
    function setupSessionTimeout() {
      const TIMEOUT_MINUTES = 10; 
      const WARNING_SECONDS = 60;
      
      let inactivityTimer;
      let warningTimer;
      let countdownInterval;

      const modal = document.getElementById('session-timeout-modal');
      const countdownContainer = document.getElementById('session-countdown'); // The new container div
      const countdownMinutesEl = document.getElementById('countdown-minutes');
      const countdownSecondsEl = document.getElementById('countdown-seconds');
      const stayBtn = document.getElementById('session-stay-btn');

      if (!modal || !countdownContainer || !countdownMinutesEl || !countdownSecondsEl || !stayBtn) {
        console.warn('Session timeout modal elements not found or incomplete. Timeout disabled.');
        return;
      }

      const logoutUser = () => {
        supabase.auth.signOut();
        // Manually redirect to be safe, as onAuthStateChange might not be set up here
        location.replace("/auth.html?tab=in&reason=timeout");
      };

      const updateCountdownDisplay = (totalSeconds) => {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        countdownMinutesEl.textContent = String(minutes).padStart(2, '0');
        countdownSecondsEl.textContent = String(seconds).padStart(2, '0');
      };

      const showWarning = () => {
        modal.classList.remove('hidden');
        countdownContainer.classList.add('active-warning'); // Add animation class

        let remaining = WARNING_SECONDS;
        updateCountdownDisplay(remaining);

        countdownInterval = setInterval(() => {
          remaining--;
          updateCountdownDisplay(remaining);
          if (remaining <= 0) {
            clearInterval(countdownInterval);
          }
        }, 1000);

        warningTimer = setTimeout(logoutUser, WARNING_SECONDS * 1000);
      };

      const resetTimer = () => {
        clearTimeout(inactivityTimer);
        clearTimeout(warningTimer);
        clearInterval(countdownInterval);
        modal.classList.add('hidden');
        countdownContainer.classList.remove('active-warning'); // Remove animation class
        updateCountdownDisplay(WARNING_SECONDS); // Reset display to default
        
        inactivityTimer = setTimeout(showWarning, TIMEOUT_MINUTES * 60 * 1000); 
      };

      const userActivityEvents = ['mousemove', 'mousedown', 'keydown', 'touchstart', 'scroll'];
      userActivityEvents.forEach(event => {
        window.addEventListener(event, resetTimer, true);
      });

      stayBtn.addEventListener('click', resetTimer);

      // Initial start
      resetTimer();
    }
    // === [END SESSION TIMEOUT FUNCTION] ===


    async function ensureProfile(id, email) {
      // try fetch; if missing, create a shell row
      let { data, error } = await supabase.from("profiles").select("*").eq("id", id).maybeSingle();
      if (error && error.code !== "PGRST116") throw error; // Do not throw on "No rows"
      if (data) return data;
      // No profile, let's create one
      const up = await supabase.from("profiles")
        .upsert({ id, email, updated_at: new Date().toISOString() }, { onConflict: "id" })
        .select("*").single();
      if (up.error) throw up.error;
      return up.data;
    }

    // --- auth guard + hydrate header + modal ---
    try {
      // require session
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        const next = encodeURIComponent(location.pathname + location.search + location.hash);
        location.replace(`/auth.html?tab=in&redirect=${next}`);
        throw new Error("redirecting"); // Stop script execution
      }

      const { data: { user } } = await supabase.auth.getUser();
      if (!user) throw new Error("User not found despite session.");

      const row = await ensureProfile(user.id, user.email || null);

      const profileComplete = computeProfileComplete(row || {});
      const kycDone = resolveKycBoolean(row || {});

      // header name (prefer first + last; fallback email handle)
      const fn = (row?.first_name || "").trim();
      const ln = (row?.last_name || "").trim();
      const fallback = (user.email || "User").split("@")[0];
      setText("hdr-name", (fn || ln) ? `${fn} ${ln}`.trim() : fallback);

      // avatar (cache-bust public URL)
      const avatarUrl = row?.avatar_url ? `${row.avatar_url}${row.avatar_url.includes("?") ? "&" : "?"}v=${Date.now()}` : BLANK_AVATAR;
      setSrc("hdr-avatar", avatarUrl);

      // profile modal wiring
      const modal = document.getElementById("profile-modal");
      const pmEmail = document.getElementById("pm-email");
      const btnOpen = document.getElementById("hdr-profile-btn");
      const btnLogout = document.getElementById("pm-logout");

      if (modal && pmEmail && btnOpen && btnLogout) {
        const open = () => { pmEmail.textContent = user.email || "—"; modal.classList.remove("hidden"); };
        const close = () => modal.classList.add("hidden");

        btnOpen.addEventListener("click", (e) => { e.preventDefault(); open(); });
        modal.addEventListener("click", (e) => {
          if (e.target === modal || e.target.classList.contains("bg-black/40")) close();
        });
        window.addEventListener("keydown", (e) => { if (e.key === "Escape") close(); });

        btnLogout.addEventListener('click', async () => {
          try {
            await supabase.auth.signOut();
            location.replace("/auth.html?tab=in");
          } catch {
            console.warn("Logout failed");
          }
        });
      } else {
        console.warn("Profile modal elements not found. Modal may not work.");
      }

 
      setupSessionTimeout();

    } catch (e) {
      // ignore “redirecting”
      if (String(e?.message).toLowerCase() !== "redirecting") console.error(e);
    }
  </script>
</body>

</html>
